---
import MainLayout from '../../layouts/MainLayout.astro';
import PhotoGrid from '../../components/PhotoGrid.astro';
import { getCollections, getImages } from '../../data/imageStore';
import siteConfig from '../../../site.config.mjs';

const allCollection = {
	id: undefined,
	name: 'Todo',
};
const collections = [allCollection, ...(await getCollections())];
const { collection } = Astro.params;
const images = await getImages(collection ? { collection } : {});

const currentCollection = collections.find(c => c.id === collection);
const pageTitle = currentCollection ? `${currentCollection.name} - ${siteConfig.title}` : `Galería - ${siteConfig.title}`;
const pageDescription = currentCollection ? `Explora la colección ${currentCollection.name} de ${siteConfig.owner}. ${siteConfig.description}` : siteConfig.description;

export const getStaticPaths = async () => {
	return [{ id: undefined }, ...(await getCollections())].map((collection) => {
		return {
			params: { collection: collection.id },
		};
	});
};
---

<MainLayout title={pageTitle} description={pageDescription}>
	{currentCollection && currentCollection.id && (
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "BreadcrumbList",
			"itemListElement": [
				{
					"@type": "ListItem",
					"position": 1,
					"name": "Inicio",
					"item": siteConfig.siteUrl
				},
				{
					"@type": "ListItem",
					"position": 2,
					"name": "Galería",
					"item": `${siteConfig.siteUrl}collections/`
				},
				{
					"@type": "ListItem",
					"position": 3,
					"name": currentCollection.name,
					"item": `${siteConfig.siteUrl}collections/${currentCollection.id}`
				}
			]
		})} />
	)}
	<section class="py-20 pt-28">
		<div class="container-custom">
			<div class="section-shell p-8 md:p-10">
				<div class="mb-10 text-center space-y-4">
					<span class="badge-soft">Colecciones</span>
					<h1 class="text-4xl md:text-5xl font-semibold title-gradient">Galería</h1>
					<p class="text-lg text-[hsl(215,18%,32%)] max-w-2xl mx-auto">
						Explora series fotográficas seleccionadas: retratos intimistas, paisajes cálidos y escenas editoriales con foco en la luz.
					</p>
				</div>

				<div class="flex justify-center mb-8">
					<div class="flex flex-wrap gap-2 justify-center">
						{
							collections.map((collectionBtn) => (
								<a href={`/collections/${collectionBtn.id ? collectionBtn.id : ''}`}>
									<div
										class={`button-ghost ${
											collectionBtn.id === collection
												? 'border-[hsla(31,66%,60%,0.35)] bg-[hsla(31,66%,60%,0.12)] text-[hsl(220,33%,12%)]'
												: ''
										}`}
									>
										{collectionBtn.name}
									</div>
								</a>
							))
						}
					</div>
				</div>

				<PhotoGrid images={images} />
			</div>
		</div>
	</section>
</MainLayout>
